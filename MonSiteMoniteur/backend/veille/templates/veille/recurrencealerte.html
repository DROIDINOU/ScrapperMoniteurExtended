{% extends 'veille/base.html' %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800 text-center">Configurer la r√©currence de votre veille</h1>

    <div class="row">
        <div class="col-md-8 offset-md-2">

            <div class="card shadow mb-4">

                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">D√©finissez la fr√©quence d'ex√©cution</h6>
                </div>

                <div class="card-body">

                    <p class="mb-3">
                        <strong>Choisissez</strong> √† quelle fr√©quence votre veille doit √™tre ex√©cut√©e automatiquement.
                    </p>

                    <form id="recurrenceForm" method="POST" action="{% url 'update_veille_recurrence' veille.id %}">
                        {% csrf_token %}

                        <!-- FREQUENCE -->
                        <label class="font-weight-bold">Fr√©quence</label>
                        <select name="frequency" id="frequency" class="form-control mb-3" required>
                            <option value="">-- S√©lectionnez une fr√©quence --</option>
                            <option value="daily">Quotidienne</option>
                            <option value="weekly">Hebdomadaire</option>
                            <option value="monthly">Mensuelle</option>
                        </select>

                        <!-- JOUR DE LA SEMAINE -->
                        <div id="weekdayBlock" style="display:none;">
                            <label class="font-weight-bold">Jour de la semaine (si hebdomadaire)</label>
                            <select name="weekday" class="form-control mb-3">
                                <option value="">-- Choisissez un jour --</option>
                                <option value="monday">Lundi</option>
                                <option value="tuesday">Mardi</option>
                                <option value="wednesday">Mercredi</option>
                                <option value="thursday">Jeudi</option>
                                <option value="friday">Vendredi</option>
                                <option value="saturday">Samedi</option>
                                <option value="sunday">Dimanche</option>
                            </select>
                        </div>
                        <!-- BOUTONS -->
                        <div class="d-flex justify-content-between mt-3">
                            <a href="{% url 'dashboard_veille' %}" class="btn btn-outline-secondary flex-fill me-2">Annuler</a>
                            <button type="submit" class="btn btn-success flex-fill">Enregistrer la r√©currence</button>
                        </div>
                    </form>

                    <hr>
                </div>
            </div>

            <div id="autoAlert" class="alert alert-info mt-3 text-center" style="transition: opacity 0.5s ease;">
                üìä Les r√©sultats appara√Ætront automatiquement dans votre tableau de bord.
            </div>


        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
const alertBox = document.getElementById("autoAlert");

  if (!alertBox) {
    console.log("‚ùå √âchec : √©l√©ment #autoAlert introuvable.");
    return;
  }

  console.log("‚úÖ √âl√©ment #autoAlert trouv√©.");

  // Affiche l'alerte
  alertBox.textContent = "Votre veille TVA a bien √©t√© cr√©√©e.";
  alertBox.style.display = "block";
  alertBox.classList.add("show");
  console.log("üîî Alerte affich√©e.");

  // Masque l'alerte apr√®s 5 secondes
  setTimeout(() => {
    alertBox.classList.remove("show");
    alertBox.style.display = "none";
    console.log("üïí Alerte masqu√©e apr√®s d√©lai.");
  }, 5000);
    const frequencySelect = document.getElementById("frequency");
    const weekdayBlock = document.getElementById("weekdayBlock");

    frequencySelect.addEventListener("change", function () {
        if (this.value === "weekly") {
            weekdayBlock.style.display = "block";
        } else {
            weekdayBlock.style.display = "none";
        }
    });
});


</script>
{% endblock %}
