{% extends 'veille/base.html' %}

{% block content %}

<div class="container py-4">
    <h2 class="mb-3 text-primary text-center">Veille par mots-cl√©s (Fuzzy Search)</h2>
    <p class="text-muted text-center">
        Entrez des mots-cl√©s. D√®s qu‚Äôune d√©cision judiciaire contient l‚Äôun d‚Äôeux, une alerte est cr√©√©e.
    </p>

    <!-- Formulaire centr√© -->
    <form method="POST" action="{% url 'veille_fuzzy' %}" class="mx-auto" style="max-width: 500px;" id="veilleForm">
        {% csrf_token %}

        <!-- ‚úÖ NOM DE LA VEILLE -->
        <div class="form-group mb-3">
            <label><strong>Nom de la veille</strong></label>
            <input type="text"
                name="veille_nom"
                class="form-control form-control-sm"
                placeholder="Exemple : Suivi proc√©dures Charleroi" style="max-width: 100%;" id="veille_nom">
        </div>

        <!-- ‚úÖ MOTS-CL√âS -->
        <div class="form-group mb-3">
            <label>Mot-cl√©(s)</label>
            <input type="text" name="keywords" class="form-control form-control-sm"
                   placeholder="ex : dissolution, liquidation" style="max-width: 100%;" id="keyword1">
        </div>

        <!-- ----- ACCORDEON POUR FILTRES SUPPLEMENTAIRES ----- -->
        <div class="accordion" id="filtersAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingFilters">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFilters" aria-expanded="false" aria-controls="collapseFilters">
                        Ajouter des filtres suppl√©mentaires
                    </button>
                </h2>
                <div id="collapseFilters" class="accordion-collapse collapse" aria-labelledby="headingFilters" data-bs-parent="#filtersAccordion">
                    <div class="accordion-body">
                        <!-- Type de d√©cision -->
                        <div class="form-group mb-3">
                            <label for="decision_type">Type de d√©cision</label>
                            <select name="decision_type" class="form-control form-control-sm" id="decision_type">
                                <option value="">S√©lectionnez un type de d√©cision</option>
                                <option value="condamnation">Condamnation</option>
                                <option value="radiation">Radiation</option>
                                <option value="dissolution">Dissolution</option>
                                <option value="liquidation">Liquidation</option>
                            </select>
                        </div>

                        <!-- Filtre Date de publication -->
                        <div class="form-group mb-3">
                            <label for="date_from">Date de publication (d√©but)</label>
                            <input type="date" name="date_from" class="form-control form-control-sm" id="date_from">
                        </div>

                        <div class="form-group mb-3">
                            <label for="date_to">Date de publication (fin)</label>
                            <input type="date" name="date_to" class="form-control form-control-sm" id="date_to">
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Boutons c√¥te √† c√¥te avec plus de centrage -->
        <div class="d-flex justify-content-between mt-3">
            <!-- Bouton pour valider les champs -->
            <button type="button" id="validateBtn" class="btn btn-primary btn-sm"
                    style="font-size: 1rem; width: 48%;">
                Valider
            </button>

            <!-- Bouton pour soumettre, initialement cach√© -->
            <button type="submit" id="submitButton"
                    class="btn btn-success btn-sm"
                    style="width: 48%;" disabled>
                Enregistrer mes mots-cl√©s et cr√©er la veille
            </button>
        </div>

        <div class="alert alert-info mt-3 text-center">
            üìä Les r√©sultats appara√Ætront automatiquement dans votre tableau de bord.
        </div>

    </form>

</div>

<!-- Popup Modal pour la limite de caract√®res -->
<div class="modal fade" id="limitModal" tabindex="-1" aria-labelledby="limitModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="limitModalLabel">Limite de caract√®res d√©pass√©e</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Vous avez d√©pass√© la limite de caract√®res autoris√©e. Le nom de la veille ne doit pas exc√©der 50 caract√®res et les mots-cl√©s ne doivent pas exc√©der 100 caract√®res.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const validateBtn = document.getElementById("validateBtn");
    const submitButton = document.getElementById("submitButton");

    const veilleNom = document.getElementById("veille_nom");
    const keywordInput = document.getElementById("keyword1");

    // Initialisation du modal
    const limitModal = new bootstrap.Modal(document.getElementById('limitModal'));

    // Fonction pour valider la longueur des champs
    function validateFields() {
        let validationPassed = true;

        // V√©rification du nom de la veille
        if (veilleNom.value.length > 50) {
            validationPassed = false;
            limitModal.show();  // Affiche le modal si la limite est d√©pass√©e
        }

        // V√©rification des mots-cl√©s
        if (keywordInput.value.length > 100) {
            validationPassed = false;
            limitModal.show();  // Affiche le modal si la limite est d√©pass√©e
        }

        // Si tout est valide, on active le bouton "Enregistrer"
        if (validationPassed) {
            submitButton.disabled = false;
        } else {
            submitButton.disabled = true;
        }
    }

    // Lorsque l'utilisateur clique sur le bouton de validation
    validateBtn.addEventListener("click", function () {
        validateFields();  // Valide les champs et affiche le modal si n√©cessaire
    });

});
</script>
{% endblock %}
